<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Sankalp Field Attendance</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #2d3748;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .header {
      width: 100%;
      max-width: 500px;
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    .form-container {
      width: 100%;
      max-width: 500px;
      background: #f7fafc;
      border-radius: 24px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      overflow: hidden;
      padding: 0;
    }
    .card {
      transition: transform 0.2s;
    }
    .btn {
      transition: all 0.3s ease;
      font-weight: 600;
      border-radius: 12px;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn:active {
      transform: scale(0.98);
    }
    .input-group {
      margin-bottom: 20px;
    }
    .input-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 6px;
    }
    .form-input, .form-select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      background: white;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #667eea;
    }
    .hidden {
      display: none;
    }
    /* Menu / Tab Styles */
    .menu-bar {
      display: flex;
      background: #edf2f7;
      padding: 5px;
      border-radius: 12px;
      margin: 15px;
    }
    .menu-tab {
      flex: 1;
      text-align: center;
      padding: 10px 5px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      border-radius: 10px;
      transition: 0.3s;
      color: #718096;
    }
    .menu-tab.active {
      background: white;
      color: #667eea;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    /* Loading Spinner */
    .loader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 12px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      display: none;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { transform: translate(-50%, 100%); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }
    .select2-container--default .select2-selection--single {
      height: 48px !important;
      padding: 10px !important;
      border: 2px solid #e2e8f0 !important;
      border-radius: 12px !important;
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 46px !important;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #e2e8f0;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f7fafc;
    }
  </style>
</head>
<body>

  <div id="loaderOverlay" class="loader-overlay">
    <div class="loader"></div>
  </div>

  <div id="toast" class="toast"></div>

  <header class="header">
    <h1 class="text-3xl font-bold">Sankalp Field</h1>
    <p id="welcomeText" class="text-indigo-100 mt-2"></p>
  </header>

  <section id="loginSection" class="form-container p-8">
    <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Login</h2>
    <div class="input-group">
      <label>Employee Code</label>
      <input type="text" id="empCode" class="form-input" placeholder="Enter your code">
    </div>
    <div class="input-group">
      <label>Password</label>
      <input type="password" id="password" class="form-input" placeholder="••••••••">
    </div>
    <button onclick="handleLogin()" class="btn w-full bg-indigo-600 text-white hover:bg-indigo-700">Login</button>
  </section>

  <main id="mainSection" class="form-container hidden">
    
    <div class="menu-bar">
      <div id="tabAttendance" class="menu-tab active" onclick="switchTab('attendance')">Attendance</div>
      <div id="tabCustomers" class="menu-tab" onclick="switchTab('customers')">Customer Master</div>
      <div id="tabSales" class="menu-tab" onclick="switchTab('sales')">Sales Entry</div>
    </div>

    <div id="moduleAttendance" class="p-6">
      <div class="card bg-white p-6 rounded-2xl shadow-sm mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold">Punch Log</h3>
          <span id="punchStatus" class="px-3 py-1 bg-red-100 text-red-600 rounded-full text-xs font-bold uppercase">Punched Out</span>
        </div>
        
        <div class="input-group">
          <label>Select Store</label>
          <select id="storeSelect" class="form-select select2-enable">
            <option value="">-- Choose Store --</option>
            <option value="Sankalp Retail Store-Sangrur">Sankalp Retail Store-Sangrur</option>
            <option value="Sankalp Retail Store-Malerkotla">Sankalp Retail Store-Malerkotla</option>
            <option value="Sankalp Retail Store-Patiala">Sankalp Retail Store-Patiala</option>
            <option value="Sankalp Retail Store-Nabha">Sankalp Retail Store-Nabha</option>
            <option value="Sankalp Retail Store-Dhuri">Sankalp Retail Store-Dhuri</option>
            <option value="Sankalp Retail Store-Amargarh">Sankalp Retail Store-Amargarh</option>
            <option value="Sankalp Retail Store-Ahmedgarh">Sankalp Retail Store-Ahmedgarh</option>
            <option value="Sankalp Retail Store-Bhawanigarh">Sankalp Retail Store-Bhawanigarh</option>
            <option value="Sankalp Retail Store-Barnala">Sankalp Retail Store-Barnala</option>
            <option value="Sankalp Retail Store-Mansa">Sankalp Retail Store-Mansa</option>
            <option value="Sankalp Retail Store-Budhlada">Sankalp Retail Store-Budhlada</option>
            <option value="Sankalp Retail Store-Bhikhi">Sankalp Retail Store-Bhikhi</option>
            <option value="Sankalp Retail Store-Bathinda">Sankalp Retail Store-Bathinda</option>
            <option value="Sankalp Retail Store-Rampura Phul">Sankalp Retail Store-Rampura Phul</option>
            <option value="Sankalp Retail Store-Maur Mandi">Sankalp Retail Store-Maur Mandi</option>
            <option value="Sankalp Retail Store-Talwandi Sabo">Sankalp Retail Store-Talwandi Sabo</option>
            <option value="Sankalp Retail Store-Faridkot">Sankalp Retail Store-Faridkot</option>
            <option value="Sankalp Retail Store-Kotkapura">Sankalp Retail Store-Kotkapura</option>
            <option value="Sankalp Retail Store-Jaitu">Sankalp Retail Store-Jaitu</option>
            <option value="Sankalp Retail Store-Muktsar">Sankalp Retail Store-Muktsar</option>
            <option value="Sankalp Retail Store-Malout">Sankalp Retail Store-Malout</option>
            <option value="Sankalp Retail Store-Gidderbaha">Sankalp Retail Store-Gidderbaha</option>
            <option value="Sankalp Retail Store-Fazilka">Sankalp Retail Store-Fazilka</option>
            <option value="Sankalp Retail Store-Abohar">Sankalp Retail Store-Abohar</option>
            <option value="Sankalp Retail Store-Jalalabad">Sankalp Retail Store-Jalalabad</option>
            <option value="Sankalp Retail Store-Ferozepur">Sankalp Retail Store-Ferozepur</option>
            <option value="Sankalp Retail Store-Zira">Sankalp Retail Store-Zira</option>
            <option value="Sankalp Retail Store-Moga">Sankalp Retail Store-Moga</option>
            <option value="Sankalp Retail Store-Dharamkot">Sankalp Retail Store-Dharamkot</option>
            <option value="Sankalp Retail Store-Ludhiana">Sankalp Retail Store-Ludhiana</option>
            <option value="Sankalp Retail Store-Khanna">Sankalp Retail Store-Khanna</option>
            <option value="Sankalp Retail Store-Jagraon">Sankalp Retail Store-Jagraon</option>
            <option value="Sankalp Retail Store-Samrala">Sankalp Retail Store-Samrala</option>
            <option value="Sankalp Retail Store-Raikot">Sankalp Retail Store-Raikot</option>
            <option value="Sankalp Retail Store-Doraha">Sankalp Retail Store-Doraha</option>
            <option value="Sankalp Retail Store-Mullanpur">Sankalp Retail Store-Mullanpur</option>
            <option value="Sankalp Retail Store-Jalandhar">Sankalp Retail Store-Jalandhar</option>
            <option value="Sankalp Retail Store-Nakodar">Sankalp Retail Store-Nakodar</option>
            <option value="Sankalp Retail Store-Shahkot">Sankalp Retail Store-Shahkot</option>
            <option value="Sankalp Retail Store-Kartarpur">Sankalp Retail Store-Kartarpur</option>
            <option value="Sankalp Retail Store-Adampur">Sankalp Retail Store-Adampur</option>
            <option value="Sankalp Retail Store-Phagwara">Sankalp Retail Store-Phagwara</option>
            <option value="Sankalp Retail Store-Kapurthala">Sankalp Retail Store-Kapurthala</option>
            <option value="Sankalp Retail Store-Sultanpur Lodhi">Sankalp Retail Store-Sultanpur Lodhi</option>
            <option value="Sankalp Retail Store-Hoshiarpur">Sankalp Retail Store-Hoshiarpur</option>
            <option value="Sankalp Retail Store-Dasuya">Sankalp Retail Store-Dasuya</option>
            <option value="Sankalp Retail Store-Mukerian">Sankalp Retail Store-Mukerian</option>
            <option value="Sankalp Retail Store-Garhshankar">Sankalp Retail Store-Garhshankar</option>
            <option value="Sankalp Retail Store-Amritsar">Sankalp Retail Store-Amritsar</option>
            <option value="Sankalp Retail Store-Ajnala">Sankalp Retail Store-Ajnala</option>
            <option value="Sankalp Retail Store-Baba Bakala">Sankalp Retail Store-Baba Bakala</option>
            <option value="Sankalp Retail Store-Tarn Taran">Sankalp Retail Store-Tarn Taran</option>
            <option value="Sankalp Retail Store-Patti">Sankalp Retail Store-Patti</option>
            <option value="Sankalp Retail Store-Khadur Sahib">Sankalp Retail Store-Khadur Sahib</option>
            <option value="Sankalp Retail Store-Gurdaspur">Sankalp Retail Store-Gurdaspur</option>
            <option value="Sankalp Retail Store-Batala">Sankalp Retail Store-Batala</option>
            <option value="Sankalp Retail Store-Dera Baba Nanak">Sankalp Retail Store-Dera Baba Nanak</option>
            <option value="Sankalp Retail Store-Pathankot">Sankalp Retail Store-Pathankot</option>
            <option value="Sankalp Retail Store-Ropar">Sankalp Retail Store-Ropar</option>
            <option value="Sankalp Retail Store-Morinda">Sankalp Retail Store-Morinda</option>
            <option value="Sankalp Retail Store-Nangal">Sankalp Retail Store-Nangal</option>
            <option value="Sankalp Retail Store-Mohali">Sankalp Retail Store-Mohali</option>
            <option value="Sankalp Retail Store-Kharar">Sankalp Retail Store-Kharar</option>
            <option value="Sankalp Retail Store-Dera Bassi">Sankalp Retail Store-Dera Bassi</option>
            <option value="Sankalp Retail Store-Fatehgarh Sahib">Sankalp Retail Store-Fatehgarh Sahib</option>
            <option value="Sankalp Retail Store-Sirhind">Sankalp Retail Store-Sirhind</option>
            <option value="Sankalp Retail Store-Mandi Gobindgarh">Sankalp Retail Store-Mandi Gobindgarh</option>
          </select>
        </div>

        <div id="punchButtons" class="grid grid-cols-2 gap-4">
          <button id="punchInBtn" onclick="handlePunchIn()" class="btn bg-green-500 text-white hover:bg-green-600">Punch In</button>
          <button id="punchOutBtn" onclick="handlePunchOut()" class="btn bg-red-500 text-white hover:bg-red-600 opacity-50 cursor-not-allowed" disabled>Punch Out</button>
        </div>
      </div>

      <div id="activitySection" class="card bg-white p-6 rounded-2xl shadow-sm hidden">
        <h3 class="text-lg font-bold mb-6">Activity Log</h3>
        
        <div class="input-group">
          <label>Activity Type</label>
          <select id="activityType" class="form-select">
            <option value="Dealer Visit">Dealer Visit</option>
            <option value="Field Day">Field Day</option>
            <option value="Farmer Meeting">Farmer Meeting</option>
            <option value="Demo Setup">Demo Setup</option>
          </select>
        </div>

        <div class="input-group">
          <label>Message / Remark</label>
          <textarea id="activityMsg" class="form-input" rows="3" placeholder="Enter details..."></textarea>
        </div>

        <div class="input-group">
          <label>Upload Images</label>
          <input type="file" id="activityImages" class="form-input" accept="image/*" multiple>
          <div id="imagePreview" class="flex gap-2 mt-2 overflow-x-auto"></div>
        </div>

        <button onclick="submitActivity()" class="btn w-full bg-indigo-600 text-white hover:bg-indigo-700">Submit Activity</button>
      </div>
    </div>

    <div id="moduleCustomers" class="p-6 hidden">
      <div class="card bg-white p-6 rounded-2xl shadow-sm">
        <h3 class="text-lg font-bold mb-6 text-indigo-600">Add Customer Details</h3>
        
        <div class="input-group">
          <label>Customer Name</label>
          <input type="text" id="custName" class="form-input" placeholder="Full Name">
        </div>

        <div class="input-group">
          <label>Mobile Number</label>
          <input type="tel" id="custMobile" class="form-input" placeholder="10 Digit Number">
        </div>

        <div class="input-group">
          <label>Customer Type</label>
          <select id="custType" class="form-select">
            <option value="Partner">Partner</option>
            <option value="Mitra">Mitra</option>
          </select>
        </div>

        <div class="input-group">
          <label>Select Store</label>
          <select id="custStore" class="form-select select2-enable">
            <option value="">-- Choose Store --</option>
            <option value="Sankalp Retail Store-Sangrur">Sankalp Retail Store-Sangrur</option>
            <option value="Sankalp Retail Store-Malerkotla">Sankalp Retail Store-Malerkotla</option>
            <option value="Sankalp Retail Store-Patiala">Sankalp Retail Store-Patiala</option>
            <option value="Sankalp Retail Store-Nabha">Sankalp Retail Store-Nabha</option>
            <option value="Sankalp Retail Store-Dhuri">Sankalp Retail Store-Dhuri</option>
            <option value="Sankalp Retail Store-Amargarh">Sankalp Retail Store-Amargarh</option>
            <option value="Sankalp Retail Store-Ahmedgarh">Sankalp Retail Store-Ahmedgarh</option>
            <option value="Sankalp Retail Store-Bhawanigarh">Sankalp Retail Store-Bhawanigarh</option>
            <option value="Sankalp Retail Store-Barnala">Sankalp Retail Store-Barnala</option>
            <option value="Sankalp Retail Store-Mansa">Sankalp Retail Store-Mansa</option>
            <option value="Sankalp Retail Store-Budhlada">Sankalp Retail Store-Budhlada</option>
            <option value="Sankalp Retail Store-Bhikhi">Sankalp Retail Store-Bhikhi</option>
            <option value="Sankalp Retail Store-Bathinda">Sankalp Retail Store-Bathinda</option>
            <option value="Sankalp Retail Store-Rampura Phul">Sankalp Retail Store-Rampura Phul</option>
            <option value="Sankalp Retail Store-Maur Mandi">Sankalp Retail Store-Maur Mandi</option>
            <option value="Sankalp Retail Store-Talwandi Sabo">Sankalp Retail Store-Talwandi Sabo</option>
            <option value="Sankalp Retail Store-Faridkot">Sankalp Retail Store-Faridkot</option>
            <option value="Sankalp Retail Store-Kotkapura">Sankalp Retail Store-Kotkapura</option>
            <option value="Sankalp Retail Store-Jaitu">Sankalp Retail Store-Jaitu</option>
            <option value="Sankalp Retail Store-Muktsar">Sankalp Retail Store-Muktsar</option>
            <option value="Sankalp Retail Store-Malout">Sankalp Retail Store-Malout</option>
            <option value="Sankalp Retail Store-Gidderbaha">Sankalp Retail Store-Gidderbaha</option>
            <option value="Sankalp Retail Store-Fazilka">Sankalp Retail Store-Fazilka</option>
            <option value="Sankalp Retail Store-Abohar">Sankalp Retail Store-Abohar</option>
            <option value="Sankalp Retail Store-Jalalabad">Sankalp Retail Store-Jalalabad</option>
            <option value="Sankalp Retail Store-Ferozepur">Sankalp Retail Store-Ferozepur</option>
            <option value="Sankalp Retail Store-Zira">Sankalp Retail Store-Zira</option>
            <option value="Sankalp Retail Store-Moga">Sankalp Retail Store-Moga</option>
            <option value="Sankalp Retail Store-Dharamkot">Sankalp Retail Store-Dharamkot</option>
            <option value="Sankalp Retail Store-Ludhiana">Sankalp Retail Store-Ludhiana</option>
            <option value="Sankalp Retail Store-Khanna">Sankalp Retail Store-Khanna</option>
            <option value="Sankalp Retail Store-Jagraon">Sankalp Retail Store-Jagraon</option>
            <option value="Sankalp Retail Store-Samrala">Sankalp Retail Store-Samrala</option>
            <option value="Sankalp Retail Store-Raikot">Sankalp Retail Store-Raikot</option>
            <option value="Sankalp Retail Store-Doraha">Sankalp Retail Store-Doraha</option>
            <option value="Sankalp Retail Store-Mullanpur">Sankalp Retail Store-Mullanpur</option>
            <option value="Sankalp Retail Store-Jalandhar">Sankalp Retail Store-Jalandhar</option>
            <option value="Sankalp Retail Store-Nakodar">Sankalp Retail Store-Nakodar</option>
            <option value="Sankalp Retail Store-Shahkot">Sankalp Retail Store-Shahkot</option>
            <option value="Sankalp Retail Store-Kartarpur">Sankalp Retail Store-Kartarpur</option>
            <option value="Sankalp Retail Store-Adampur">Sankalp Retail Store-Adampur</option>
            <option value="Sankalp Retail Store-Phagwara">Sankalp Retail Store-Phagwara</option>
            <option value="Sankalp Retail Store-Kapurthala">Sankalp Retail Store-Kapurthala</option>
            <option value="Sankalp Retail Store-Sultanpur Lodhi">Sankalp Retail Store-Sultanpur Lodhi</option>
            <option value="Sankalp Retail Store-Hoshiarpur">Sankalp Retail Store-Hoshiarpur</option>
            <option value="Sankalp Retail Store-Dasuya">Sankalp Retail Store-Dasuya</option>
            <option value="Sankalp Retail Store-Mukerian">Sankalp Retail Store-Mukerian</option>
            <option value="Sankalp Retail Store-Garhshankar">Sankalp Retail Store-Garhshankar</option>
            <option value="Sankalp Retail Store-Amritsar">Sankalp Retail Store-Amritsar</option>
            <option value="Sankalp Retail Store-Ajnala">Sankalp Retail Store-Ajnala</option>
            <option value="Sankalp Retail Store-Baba Bakala">Sankalp Retail Store-Baba Bakala</option>
            <option value="Sankalp Retail Store-Tarn Taran">Sankalp Retail Store-Tarn Taran</option>
            <option value="Sankalp Retail Store-Patti">Sankalp Retail Store-Patti</option>
            <option value="Sankalp Retail Store-Khadur Sahib">Sankalp Retail Store-Khadur Sahib</option>
            <option value="Sankalp Retail Store-Gurdaspur">Sankalp Retail Store-Gurdaspur</option>
            <option value="Sankalp Retail Store-Batala">Sankalp Retail Store-Batala</option>
            <option value="Sankalp Retail Store-Dera Baba Nanak">Sankalp Retail Store-Dera Baba Nanak</option>
            <option value="Sankalp Retail Store-Pathankot">Sankalp Retail Store-Pathankot</option>
            <option value="Sankalp Retail Store-Ropar">Sankalp Retail Store-Ropar</option>
            <option value="Sankalp Retail Store-Morinda">Sankalp Retail Store-Morinda</option>
            <option value="Sankalp Retail Store-Nangal">Sankalp Retail Store-Nangal</option>
            <option value="Sankalp Retail Store-Mohali">Sankalp Retail Store-Mohali</option>
            <option value="Sankalp Retail Store-Kharar">Sankalp Retail Store-Kharar</option>
            <option value="Sankalp Retail Store-Dera Bassi">Sankalp Retail Store-Dera Bassi</option>
            <option value="Sankalp Retail Store-Fatehgarh Sahib">Sankalp Retail Store-Fatehgarh Sahib</option>
            <option value="Sankalp Retail Store-Sirhind">Sankalp Retail Store-Sirhind</option>
            <option value="Sankalp Retail Store-Mandi Gobindgarh">Sankalp Retail Store-Mandi Gobindgarh</option>
          </select>
        </div>

        <button onclick="submitCustomerMaster()" class="btn w-full bg-purple-600 text-white hover:bg-purple-700 mt-4">Save Customer</button>
      </div>

      <div class="card bg-white p-6 rounded-2xl shadow-sm mt-6">
        <h3 class="text-lg font-bold mb-4">Your Customers</h3>
        <div class="input-group">
          <label>Filter Month</label>
          <select id="custMonthFilter" class="form-select" onchange="loadCustomerData()">
            <option value="">All Time</option>
          </select>
        </div>
        <table id="custTable" class="w-full text-sm">
          <thead><tr><th>Date</th><th>Store</th><th>Name</th><th>Mobile</th><th>Type</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div id="moduleSales" class="p-6 hidden">
      <div class="card bg-white p-6 rounded-2xl shadow-sm">
        <h3 class="text-lg font-bold mb-6 text-green-600">New Sale Entry</h3>
        
        <div class="input-group">
          <label>Select Customer</label>
          <select id="saleCustomerSelect" class="form-select select2-enable">
            <option value="">-- Select Customer --</option>
          </select>
        </div>

        <div class="input-group">
          <label>Item / Product Name</label>
          <input type="text" id="saleItem" class="form-input" placeholder="What was sold?">
        </div>

        <div class="input-group">
          <label>Sale Amount (₹)</label>
          <input type="number" id="saleAmount" class="form-input" placeholder="0.00">
        </div>

        <div class="input-group">
          <label>Select Store</label>
          <select id="saleStore" class="form-select select2-enable">
            <option value="">-- Choose Store --</option>
            <option value="Sankalp Retail Store-Sangrur">Sankalp Retail Store-Sangrur</option>
            <option value="Sankalp Retail Store-Malerkotla">Sankalp Retail Store-Malerkotla</option>
            <option value="Sankalp Retail Store-Patiala">Sankalp Retail Store-Patiala</option>
            <option value="Sankalp Retail Store-Nabha">Sankalp Retail Store-Nabha</option>
            <option value="Sankalp Retail Store-Dhuri">Sankalp Retail Store-Dhuri</option>
            <option value="Sankalp Retail Store-Amargarh">Sankalp Retail Store-Amargarh</option>
            <option value="Sankalp Retail Store-Ahmedgarh">Sankalp Retail Store-Ahmedgarh</option>
            <option value="Sankalp Retail Store-Bhawanigarh">Sankalp Retail Store-Bhawanigarh</option>
            <option value="Sankalp Retail Store-Barnala">Sankalp Retail Store-Barnala</option>
            <option value="Sankalp Retail Store-Mansa">Sankalp Retail Store-Mansa</option>
            <option value="Sankalp Retail Store-Budhlada">Sankalp Retail Store-Budhlada</option>
            <option value="Sankalp Retail Store-Bhikhi">Sankalp Retail Store-Bhikhi</option>
            <option value="Sankalp Retail Store-Bathinda">Sankalp Retail Store-Bathinda</option>
            <option value="Sankalp Retail Store-Rampura Phul">Sankalp Retail Store-Rampura Phul</option>
            <option value="Sankalp Retail Store-Maur Mandi">Sankalp Retail Store-Maur Mandi</option>
            <option value="Sankalp Retail Store-Talwandi Sabo">Sankalp Retail Store-Talwandi Sabo</option>
            <option value="Sankalp Retail Store-Faridkot">Sankalp Retail Store-Faridkot</option>
            <option value="Sankalp Retail Store-Kotkapura">Sankalp Retail Store-Kotkapura</option>
            <option value="Sankalp Retail Store-Jaitu">Sankalp Retail Store-Jaitu</option>
            <option value="Sankalp Retail Store-Muktsar">Sankalp Retail Store-Muktsar</option>
            <option value="Sankalp Retail Store-Malout">Sankalp Retail Store-Malout</option>
            <option value="Sankalp Retail Store-Gidderbaha">Sankalp Retail Store-Gidderbaha</option>
            <option value="Sankalp Retail Store-Fazilka">Sankalp Retail Store-Fazilka</option>
            <option value="Sankalp Retail Store-Abohar">Sankalp Retail Store-Abohar</option>
            <option value="Sankalp Retail Store-Jalalabad">Sankalp Retail Store-Jalalabad</option>
            <option value="Sankalp Retail Store-Ferozepur">Sankalp Retail Store-Ferozepur</option>
            <option value="Sankalp Retail Store-Zira">Sankalp Retail Store-Zira</option>
            <option value="Sankalp Retail Store-Moga">Sankalp Retail Store-Moga</option>
            <option value="Sankalp Retail Store-Dharamkot">Sankalp Retail Store-Dharamkot</option>
            <option value="Sankalp Retail Store-Ludhiana">Sankalp Retail Store-Ludhiana</option>
            <option value="Sankalp Retail Store-Khanna">Sankalp Retail Store-Khanna</option>
            <option value="Sankalp Retail Store-Jagraon">Sankalp Retail Store-Jagraon</option>
            <option value="Sankalp Retail Store-Samrala">Sankalp Retail Store-Samrala</option>
            <option value="Sankalp Retail Store-Raikot">Sankalp Retail Store-Raikot</option>
            <option value="Sankalp Retail Store-Doraha">Sankalp Retail Store-Doraha</option>
            <option value="Sankalp Retail Store-Mullanpur">Sankalp Retail Store-Mullanpur</option>
            <option value="Sankalp Retail Store-Jalandhar">Sankalp Retail Store-Jalandhar</option>
            <option value="Sankalp Retail Store-Nakodar">Sankalp Retail Store-Nakodar</option>
            <option value="Sankalp Retail Store-Shahkot">Sankalp Retail Store-Shahkot</option>
            <option value="Sankalp Retail Store-Kartarpur">Sankalp Retail Store-Kartarpur</option>
            <option value="Sankalp Retail Store-Adampur">Sankalp Retail Store-Adampur</option>
            <option value="Sankalp Retail Store-Phagwara">Sankalp Retail Store-Phagwara</option>
            <option value="Sankalp Retail Store-Kapurthala">Sankalp Retail Store-Kapurthala</option>
            <option value="Sankalp Retail Store-Sultanpur Lodhi">Sankalp Retail Store-Sultanpur Lodhi</option>
            <option value="Sankalp Retail Store-Hoshiarpur">Sankalp Retail Store-Hoshiarpur</option>
            <option value="Sankalp Retail Store-Dasuya">Sankalp Retail Store-Dasuya</option>
            <option value="Sankalp Retail Store-Mukerian">Sankalp Retail Store-Mukerian</option>
            <option value="Sankalp Retail Store-Garhshankar">Sankalp Retail Store-Garhshankar</option>
            <option value="Sankalp Retail Store-Amritsar">Sankalp Retail Store-Amritsar</option>
            <option value="Sankalp Retail Store-Ajnala">Sankalp Retail Store-Ajnala</option>
            <option value="Sankalp Retail Store-Baba Bakala">Sankalp Retail Store-Baba Bakala</option>
            <option value="Sankalp Retail Store-Tarn Taran">Sankalp Retail Store-Tarn Taran</option>
            <option value="Sankalp Retail Store-Patti">Sankalp Retail Store-Patti</option>
            <option value="Sankalp Retail Store-Khadur Sahib">Sankalp Retail Store-Khadur Sahib</option>
            <option value="Sankalp Retail Store-Gurdaspur">Sankalp Retail Store-Gurdaspur</option>
            <option value="Sankalp Retail Store-Batala">Sankalp Retail Store-Batala</option>
            <option value="Sankalp Retail Store-Dera Baba Nanak">Sankalp Retail Store-Dera Baba Nanak</option>
            <option value="Sankalp Retail Store-Pathankot">Sankalp Retail Store-Pathankot</option>
            <option value="Sankalp Retail Store-Ropar">Sankalp Retail Store-Ropar</option>
            <option value="Sankalp Retail Store-Morinda">Sankalp Retail Store-Morinda</option>
            <option value="Sankalp Retail Store-Nangal">Sankalp Retail Store-Nangal</option>
            <option value="Sankalp Retail Store-Mohali">Sankalp Retail Store-Mohali</option>
            <option value="Sankalp Retail Store-Kharar">Sankalp Retail Store-Kharar</option>
            <option value="Sankalp Retail Store-Dera Bassi">Sankalp Retail Store-Dera Bassi</option>
            <option value="Sankalp Retail Store-Fatehgarh Sahib">Sankalp Retail Store-Fatehgarh Sahib</option>
            <option value="Sankalp Retail Store-Sirhind">Sankalp Retail Store-Sirhind</option>
            <option value="Sankalp Retail Store-Mandi Gobindgarh">Sankalp Retail Store-Mandi Gobindgarh</option>
          </select>
        </div>

        <button onclick="submitSalesEntry()" class="btn w-full bg-green-600 text-white hover:bg-green-700 mt-4">Record Sale</button>
      </div>

      <div class="card bg-white p-6 rounded-2xl shadow-sm mt-6">
        <h3 class="text-lg font-bold mb-4">Your Sales</h3>
        <div class="input-group">
          <label>Filter Month</label>
          <select id="salesMonthFilter" class="form-select" onchange="loadSalesData()">
            <option value="">All Time</option>
          </select>
        </div>
        <table id="salesTable" class="w-full text-sm">
          <thead><tr><th>Date</th><th>Store</th><th>Customer</th><th>Item</th><th>Amount</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </main>

  <script>
    const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby16l4HL16KQEODvZDiHt4Q7qEEaMZnIyfXbaguWpwolMmg8O5oog3duilIhu9R4aUDCA/exec';
    let user = null;
    let punchInData = null;

    // TABS SWITCHING LOGIC
    function switchTab(tab) {
      // Manage CSS active state
      document.querySelectorAll('.menu-tab').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('#mainSection > div').forEach(el => {
        if(el.id.startsWith('module')) el.classList.add('hidden');
      });

      if (tab === 'attendance') {
        document.getElementById('tabAttendance').classList.add('active');
        document.getElementById('moduleAttendance').classList.remove('hidden');
      } else if (tab === 'customers') {
        document.getElementById('tabCustomers').classList.add('active');
        document.getElementById('moduleCustomers').classList.remove('hidden');
        loadCustomerData();
      } else if (tab === 'sales') {
        document.getElementById('tabSales').classList.add('active');
        document.getElementById('moduleSales').classList.remove('hidden');
        loadSalesData();
      }

      // Refresh Select2 width if needed
      $('.select2-enable').select2({ width: '100%' });
    }

    /* ================= AUTH ================= */
    async function handleLogin() {
      const code = document.getElementById('empCode').value.trim();
      const password = document.getElementById('password').value.trim();
      if (!code || !password) { showToast("Enter credentials", "error"); return; }
      
      showLoader();
      try {
        const res = await sendToAppsScript('verifyLogin', { code, password });
        if (res.success) {
          user = res.user;
          document.getElementById('loginSection').classList.add('hidden');
          document.getElementById('mainSection').classList.remove('hidden');
          document.getElementById('welcomeText').innerText = `Welcome, ${user.name}`;
          populateMonths('custMonthFilter');
          populateMonths('salesMonthFilter');
          checkPunchStatus(user.code);
        } else {
          showToast(res.message, "error");
        }
      } catch (err) {
        showToast("Login failed", "error");
      } finally {
        hideLoader();
      }
    }

    /* ================= CUSTOMER MASTER ================= */
    async function submitCustomerMaster() {
      const name = document.getElementById('custName').value.trim();
      const mobile = document.getElementById('custMobile').value.trim();
      const type = document.getElementById('custType').value;
      const store = document.getElementById('custStore').value;

      if (!name || !mobile || !type || !store) {
        showToast("Fill all customer fields", "error");
        return;
      }

      showLoader();
      try {
        const res = await sendToAppsScript('saveCustomer', {
          code: user.code,
          store: store,
          name: name,
          mobile: mobile,
          type: type
        });
        if (res.success) {
          showToast("Customer saved!", "success");
          document.getElementById('custName').value = '';
          document.getElementById('custMobile').value = '';
          $('#custStore').val(null).trigger('change');
          loadCustomerData();
        } else {
          showToast(res.message, "error");
        }
      } catch (err) {
        showToast("Save failed", "error");
      } finally {
        hideLoader();
      }
    }

    async function loadCustomerData() {
      const month = document.getElementById('custMonthFilter').value;
      try {
        const data = await fetchFromAppsScript('getUserCustomers', {code: user.code, month});
        const tbody = document.querySelector('#custTable tbody');
        tbody.innerHTML = '';
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${new Date(row.timestamp).toLocaleDateString()}</td><td>${row.store}</td><td>${row.name}</td><td>${row.mobile}</td><td>${row.type}</td>`;
          tbody.appendChild(tr);
        });
      } catch (err) {
        showToast("Failed to load customers", "error");
      }
    }

    /* ================= SALES ENTRY ================= */
    async function submitSalesEntry() {
      const customer = document.getElementById('saleCustomerSelect').value;
      const item = document.getElementById('saleItem').value.trim();
      const amount = document.getElementById('saleAmount').value.trim();
      const store = document.getElementById('saleStore').value;

      if (!customer || !item || !amount || !store) {
        showToast("Fill all sales fields", "error");
        return;
      }

      showLoader();
      try {
        const res = await sendToAppsScript('saveSale', {
          code: user.code,
          store: store,
          customer: customer,
          item: item,
          amount: amount
        });
        if (res.success) {
          showToast("Sale recorded!", "success");
          document.getElementById('saleItem').value = '';
          document.getElementById('saleAmount').value = '';
          $('#saleCustomerSelect').val(null).trigger('change');
          $('#saleStore').val(null).trigger('change');
          loadSalesData();
        } else {
          showToast(res.message, "error");
        }
      } catch (err) {
        showToast("Entry failed", "error");
      } finally {
        hideLoader();
      }
    }

    async function loadSalesData() {
      const month = document.getElementById('salesMonthFilter').value;
      try {
        const data = await fetchFromAppsScript('getUserSales', {code: user.code, month});
        const tbody = document.querySelector('#salesTable tbody');
        tbody.innerHTML = '';
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${new Date(row.timestamp).toLocaleDateString()}</td><td>${row.store}</td><td>${row.customer}</td><td>${row.item}</td><td>${row.amount}</td>`;
          tbody.appendChild(tr);
        });
      } catch (err) {
        showToast("Failed to load sales", "error");
      }
    }

    /* ================= ATTENDANCE ================= */
    async function handlePunchIn() {
      const store = document.getElementById('storeSelect').value;
      if (!store) { showToast("Select store first", "error"); return; }
      
      showLoader();
      try {
        const pos = await getPosition();
        const res = await sendToAppsScript('punchIn', {
          code: user.code,
          name: user.name,
          store: store,
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
          timestamp: new Date().toISOString()
        });
        if (res.success) {
          showToast("Punched In Successfully", "success");
          checkPunchStatus(user.code);
        } else {
          showToast(res.message, "error");
        }
      } catch (err) {
        showToast("Location access required", "error");
      } finally {
        hideLoader();
      }
    }

    async function handlePunchOut() {
      showLoader();
      try {
        const pos = await getPosition();
        const res = await sendToAppsScript('punchOut', {
          code: user.code,
          name: user.name,
          punchInTime: punchInData.time,
          punchInLat: punchInData.lat,
          punchInLon: punchInData.lon,
          punchOutTime: new Date().toISOString(),
          punchOutLat: pos.coords.latitude,
          punchOutLon: pos.coords.longitude,
          store: punchInData.store
        });
        if (res.success) {
          showToast("Punched Out Successfully", "success");
          punchInData = null;
          updateUI();
        } else {
          showToast(res.message, "error");
        }
      } catch (err) {
        showToast("Location access required", "error");
      } finally {
        hideLoader();
      }
    }

    async function checkPunchStatus(code) {
      try {
        const res = await sendToAppsScript('checkPunchStatus', { 
          code, 
          clientTimestamp: new Date().toISOString() 
        });
        if (res.success && res.isIn) {
          punchInData = {
            time: res.punchInTime,
            lat: parseFloat(res.punchInLoc.split(',')[0]),
            lon: parseFloat(res.punchInLoc.split(',')[1]),
            store: res.store
          };
        } else {
          punchInData = null;
        }
        updateUI();
      } catch (err) {
        console.error(err);
      }
    }

    function updateUI() {
      const statusEl = document.getElementById('punchStatus');
      const inBtn = document.getElementById('punchInBtn');
      const outBtn = document.getElementById('punchOutBtn');
      const activityForm = document.getElementById('activitySection');
      const storeSelect = document.getElementById('storeSelect');

      if (punchInData) {
        statusEl.innerText = "Punched In";
        statusEl.className = "px-3 py-1 bg-green-100 text-green-600 rounded-full text-xs font-bold uppercase";
        inBtn.disabled = true;
        inBtn.classList.add('opacity-50', 'cursor-not-allowed');
        outBtn.disabled = false;
        outBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        activityForm.classList.remove('hidden');
        storeSelect.disabled = true;
        $(storeSelect).val(punchInData.store).trigger('change');
      } else {
        statusEl.innerText = "Punched Out";
        statusEl.className = "px-3 py-1 bg-red-100 text-red-600 rounded-full text-xs font-bold uppercase";
        inBtn.disabled = false;
        inBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        outBtn.disabled = true;
        outBtn.classList.add('opacity-50', 'cursor-not-allowed');
        activityForm.classList.add('hidden');
        storeSelect.disabled = false;
      }
    }

    /* ================= ACTIVITY ================= */
    async function submitActivity() {
      const type = document.getElementById('activityType').value;
      const msg = document.getElementById('activityMsg').value.trim();

      if (!type || !msg) { showToast("Fill activity fields", "error"); return; }

      showLoader();
      try {
        const pos = await getPosition();
        const payload = {
          code: user.code,
          name: user.name,
          activityType: type,
          message: msg,
          location: `${pos.coords.latitude},${pos.coords.longitude}`,
          timestamp: new Date().toISOString(),
          store: punchInData.store,
          images: []
        };

        const files = document.getElementById('activityImages').files;
        for (let file of files) {
          const base64 = await fileToBase64(file);
          payload.images.push({ name: file.name, content: base64.split(',')[1] });
        }

        const action = payload.images.length > 0 ? 'submitActivityWithImages' : 'submitActivity';
        const res = await sendToAppsScript(action, payload);
        if (res.success) {
          showToast("Activity submitted!", "success");
          document.getElementById('activityMsg').value = '';
          document.getElementById('activityImages').value = '';
        } else {
          showToast(res.message, "error");
        }
      } catch (err) {
        showToast("Error submitting", "error");
      } finally {
        hideLoader();
      }
    }

    /* ================= HELPERS ================= */
    function showLoader() { document.getElementById('loaderOverlay').style.display = 'flex'; }
    function hideLoader() { document.getElementById('loaderOverlay').style.display = 'none'; }
    
    function showToast(msg, type) {
      const toast = document.getElementById('toast');
      toast.innerText = msg;
      toast.style.background = type === 'success' ? '#48bb78' : '#f56565';
      toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, 3000);
    }

    async function sendToAppsScript(action, payload) {
      const response = await fetch(`${APPS_SCRIPT_WEB_APP_URL}?action=${action}`, {
        method: 'POST',
        body: JSON.stringify(payload)
      });
      return await response.json();
    }

    async function fetchFromAppsScript(action, params = {}) {
      const url = new URL(APPS_SCRIPT_WEB_APP_URL);
      url.searchParams.append('action', action);
      for (let k in params) url.searchParams.append(k, params[k]);
      const res = await fetch(url);
      return await res.json();
    }

    function getPosition() {
      return new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        });
      });
    }

    function fileToBase64(file) {
      return new Promise((res, rej) => {
        const reader = new FileReader();
        reader.onload = () => res(reader.result);
        reader.onerror = rej;
        reader.readAsDataURL(file);
      });
    }

    function populateMonths(selectId) {
      const sel = document.getElementById(selectId);
      const now = new Date();
      for (let i = 0; i < 12; i++) {
        const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
        const val = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        const opt = document.createElement('option');
        opt.value = val;
        opt.text = d.toLocaleString('default', { month: 'long', year: 'numeric' });
        sel.add(opt);
      }
    }

    $(document).ready(function() {
      $('.select2-enable').select2({ width: '100%' });

      $('#saleStore').on('change', async function() {
        const store = this.value;
        if (store) {
          try {
            const custs = await fetchFromAppsScript('getCustomers', { store });
            const sel = document.getElementById('saleCustomerSelect');
            sel.innerHTML = '<option value="">-- Select Customer --</option>';
            custs.forEach(c => {
              const opt = document.createElement('option');
              opt.value = c.name;
              opt.text = `${c.name} - ${c.mobile} (${c.type})`;
              sel.add(opt);
            });
            $(sel).select2({ width: '100%' });
          } catch (err) {
            showToast("Failed to load customers", "error");
          }
        }
      });
    });
  </script>
</body>
</html>
